language: node_js
node_js:
- 13.8.0
cache:
  directories:
  - "~/.npm"
  - ".jest"
jobs:
  include:
  - stage: test
    if: commit_message !~ /(storybook-deploy)/
    script:
    - yarn eslint
    - yarn test --ci
    - yarn build
  - stage: deploy
    name: Bump version and release to npm
    if: branch = master AND (NOT type = pull_request) AND (commit_message !~ /(storybook-deploy)/)
    script:
    - yarn test:coveralls
    - yarn build
    - npx semantic-release
  - stage: deploy
    name: Deploy and release storybook
    if: branch = master AND (NOT type = pull_request) AND (commit_message =~ /(storybook-deploy)/)
    deploy:
      provider: heroku
      app: MW-Design
      on:
        repo: thousight/MW-Design
      api_key:
        secure: qEhERCYOidCpse9PuAcepq12fGiQ6Ik5/cMHiFje9HB6s+8S1gLeqibUDxmR47/nPEUYGRHtFTH7bdZlurmcVv0uWPg0qBYg4fnNr/bT3CiTbjVuy599kljKxiHiWq4gcqeU5hbDtl0BaghcI0FM12WINrXUymSTgNbaaHUUx5uVgKzsfeSwJcnCyNQOxauBSK7ul9P62fx7lHnPaHOp0VHeNWB3c9il77MkaedI0mCZddQ6CoZk/dqEeITP3cw9MRH7fXBWS1d7VJzhuN4WPaJzU5mhPb87LBlIzEs+/CfHAjjRUPoTdJ5QYG+ro5jEyAKZJKxTMUQkt30uiiGYDHAFSy6E0u26sDVkXQ5npXCsJFofVvtIyANfPOT+YbWFk7B13dcMRdN/pIfPveAEp387WLhrkc4LJGXQ3m48S7w02k8LDhP9BlT7cpMW35ncjgUxW/O0ijzm7yG1ATp+izIoqxs6BdyGkarVUCS07DYwUwzEVpr+wnpOWmMFO1MMxWo6BxBFsccqviRayGi2wlWgc+JByePJpGlj764kMurA1BBwvtFUsRA9ghUo1x/IlMylRyrucPumM0bnc5OlXS4IBH7lTjQVp3MK5DbQFaEi6e3EU20uLmDmAHxf6qffYZY0ARGDbPbxQhsrTUSbmd20cXapG4XgNVlHg8RwIm4=
