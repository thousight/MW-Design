language: node_js
node_js:
- 13.8.0
cache:
  directories:
  - "~/.npm"
  - ".jest"
jobs:
  include:
  - stage: test
    if: commit_message !~ /(storybook-deploy)/
    script:
    - yarn eslint
    - yarn test --ci
    - yarn build
  - stage: deploy
    name: Bump version and release to npm
    if: branch = master AND (NOT type = pull_request) AND (commit_message !~ /(storybook-deploy)/)
    script:
    - yarn test:coveralls
    - yarn build
    - npx semantic-release
  - stage: deploy
    name: Deploy and release storybook
    if: branch = master AND (NOT type = pull_request) AND (commit_message =~ /(storybook-deploy)/)
    deploy:
      provider: heroku
      app: MW-Design
      on:
        repo: thousight/MW-Design
      api_key:
        secure: pkoCrtpNDVU9Z/RookVEocZ5OtX2dy6pKQhg/FK82emoYVw2pWiahMb182E0r+5oO1uMJYsWaupPZWWoixuAv19Dqvjk3g/oqi1ZaK/jF21oXs7DrZflevLm1qIJLRXCvJBcvvkUnaDydmqNLVu9inkW9bIA8AjwIeY2wqXIt2uSBVZcfNJlbKfvBL+HRQlBUfBMFfEMybaeBErc1tpY7PZi/MjtxcA/R5HTIhVAgsrgeXldwX0x104qmfp5R1tZa+1yRQdSumsjQ9MtFi3UKGSx0GSV+YlO6tFxv0c+HwxIOpFqE/a88D+xaoDFmMCJ/Zg02BuimAPiYTsKU/QwVDkUL+1+KNKAwUxwNOx1v6QGXq6SibAThWbtlZbqQPIo4GdTy0AIVOyTwdHHm+4Oq2k4FJ2N/1h18fPZihcieDjRAxktSBuBqgV+uByjgWCaw/39IMTO8JE8wsOI7VhGJrt8p9fNe/VxsCi2/WuS7sXhRd7Woq13YHCjjwI7Jb1ZGQ9uAZcvOFzHRYXdgFhNgcSm1Yq9HoTHZmollZbU3d7e64vg/LF/iDTmBhFj4nXpUAjJMfjncBxHLda7YB4dbRrmQvIfc1nnoRyhFPppbyK5C3I7t5oizgjKe9SfJ0TQjLZlrRCQaAt/gf3O/7sMksBx7rHkvgdYgZ59rUowfHA=
